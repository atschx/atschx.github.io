---
author: Albert
layout: post
title:  "Iptables·The Linux Firewall"
date:   2015-04-23 00:15
categories: linux
---

> 你见，或者不见，我就在那里，不卑不喜。 

## Firewall

![firewall](http://7xidkg.com1.z0.glb.clouddn.com/firewall.png)

防火墙，作用于网络边界，用以保护网络内的机器。

* 基于硬件设施进行限制
  
  ``` 
  * 基于通用系统（国内很多厂商均为此种方案）
  * 基于专用OS（芯片级）
  ```
  
* 以软件方式设置进出规则(Iptables)

伟大的`GFW`，撕心疯一样的**限制**并`保护`着`襁褓中的我们`，长大后不得不自备梯子看外面的世界。

## Iptables

Iptables 是netfilter.org的项目，linux kernel 2.4.X开始正式引入。

# practise

从一台linode主机的安全说起....

> 1. 更改ssh配置：关闭root登录、替换默认端口22
> 2. 限制进站：只允许80/443/ssh 端口进入（对外提供服务，对出站不做限制）

切入正题,重点介绍Iptables使用

![chain_order](http://7xidkg.com1.z0.glb.clouddn.com/chain_order.png)

关闭所有的INPUT FORWARD（转发） OUTPUT的所有端口

iptables -P INPUT DROP

iptables -P FORWARD DROP

iptables -P OUTPUT DROP

参数讲解：

–A 参数就看成是添加一条规则

–p 指定是什么协议，我们常用的tcp 协议，当然也有udp，例如53端口的DNS

–dport 就是目标端口，当数据从外部进入服务器为目标端口

–sport 数据从服务器出去，则为数据源端口使用

–j 就是指定是 ACCEPT -接收 或者 DROP 不接收

禁止某个IP访问

iptables -A INPUT -p tcp -s 192.168.1.2 -j DROP

–s 参数是来源（即192.168.1.2）

后面拒绝就是DROP

删除规则

iptables -D INPUT 2

删除INPUT链编号为2的规则



``` bash
#限制入口，不限制出口流量
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

#常用web服务
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
iptables -A INPUT -p tcp --dport 8080 -j ACCEPT

#import
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
```



## Ref

* [iptables详解](http://blog.chinaunix.net/uid-26495963-id-3279216.html)
* [iptables全攻略](http://www.linuxso.com/linuxpeixun/10332.html)
* [iptables-linux-firewall](http://www.yourownlinux.com/2013/05/iptables-linux-firewall.html)
* [how-to-setup-a-basic-ip-tables-configuration-on-centos-6](https://www.digitalocean.com/community/tutorials/how-to-setup-a-basic-ip-tables-configuration-on-centos-6)
* http://www.cnblogs.com/argb/p/3535179.html

> 真正的安全是一种意识，而非技术！